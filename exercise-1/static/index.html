<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <!--This SVG ELEMENT CONTAINS SVG DEFINITION-->
    <svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
        <symbol id="icon-clock" viewBox="0 0 32 32">
        <path d="M20.586 23.414l-6.586-6.586v-8.828h4v7.172l5.414 5.414zM16 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zM16 28c-6.627 0-12-5.373-12-12s5.373-12 12-12c6.627 0 12 5.373 12 12s-5.373 12-12 12z"></path>
        </symbol>
        </defs>
    </svg>

    <main>
        <h1>Users List</h1>
        <section>
            <ul id="list" class="usersList">
            </ul>            
        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
    <script>
        async function fetchData(){
            const usersList = 'https://615485ee2473940017efaed3.mockapi.io/assessment';
            let headers = new Headers();
            headers.append('Content-Type', 'application/json');

            try{
                const response = await fetch(usersList, headers);
                let data = await response.json();
                return data;
            }catch(error){
                console.log(error)
            }
        }

        async function renderUsers(){
            const data = await fetchData()

            const usersWithFormattedDate = data.map( user => {
                user.createdAt = user.createdAt.substring(0, 10);
                return user;
            });

            let source =    `{{#each this}}
                                <li id="{{id}}" class="userCard" onclick="displayMoreData({{{id}}})">
                                    <img src="{{avatar}}" alt="{{name}}" class="userAvatar">
                                    <article class="userData">
                                        <h2 class="userName">{{name}}</h2>
                                        <p class="userId"><strong>ID:</strong> {{id}}</p>
                                        <p class="userCreatedDate">
                                            <svg class="icon-clock"><use xlink:href="#icon-clock"></use></svg> {{createdAt}}
                                        </p>
                                        
                                    </article>
                                </li>
                            {{/each}}`;
            let template = Handlebars.compile(source);
            let result = template(usersWithFormattedDate)
            
            const list = document.querySelector('#list');
            list.insertAdjacentHTML('afterbegin', result);
        }

        function displayMoreData(id){
            document.querySelector(`#${CSS.escape(id)}`).classList.toggle('beingClicked')
        }

        renderUsers();

    </script>
</body>
</html>